<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì§€êµ¬ë³¸ - ë¬´ë”ìœ„ ì‰¼í„° ëª¨ë‹ˆí„°ë§</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

    <style>
        body { font-family: 'Pretendard', sans-serif; margin: 0; padding: 0; }
        
        /* ì§€ë„ ì „ì²´ í™”ë©´ ì±„ìš°ê¸° */
        #map { width: 100%; height: 100vh; }

        /* ì§€ë„ ìœ„ì— ë– ìˆëŠ” ì •ë³´ ë°•ìŠ¤ */
        .info-box {
            position: absolute; top: 10px; left: 60px; z-index: 1000;
            background: white; padding: 15px 20px; border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-align: center; min-width: 200px;
        }
        h2 { margin: 0; font-size: 16px; color: #2c3e50; }
        p { margin: 5px 0 0 0; font-size: 12px; color: #666; }
    </style>
</head>
<body>

    <div class="info-box">
        <h2>ğŸŒ ì„œìš¸ì‹œ ë¬´ë”ìœ„ ì‰¼í„° í˜„í™©</h2>
        <p id="status-msg">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <script>
        // ì§€ë„ ì´ˆê¸°í™” (ì„œìš¸ ì¤‘ì‹¬)
        var map = L.map('map').setView([37.5665, 126.9780], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        // í´ëŸ¬ìŠ¤í„° ê·¸ë£¹ ìƒì„±
        var markers = L.markerClusterGroup();

        // â˜… íŒŒì¼ëª… ìˆ˜ì •ë¨: shelter_data.csv
        Papa.parse("./shelter_data.csv", {
            download: true,       // ì„œë²„ì—ì„œ ë‹¤ìš´ë¡œë“œ
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            encoding: "UTF-8",    // UTF-8 ì €ì¥ í•„ìˆ˜
            complete: function(results) {
                var data = results.data;
                var count = 0;
                
                data.forEach(function(row) {
                    // ë°ì´í„° ë§¤ì¹­ (ìœ ì—°í•˜ê²Œ ì²˜ë¦¬)
                    var lat = row['ìœ„ë„'] || row['WGS84ìœ„ë„'];
                    var lng = row['ê²½ë„'] || row['WGS84ê²½ë„'];
                    var name = row['ì‰¼í„°ëª…ì¹­'] || row['ì‰¼í„°ëª…'] || "ì´ë¦„ì—†ìŒ";
                    var address = row['ë„ë¡œëª…ì£¼ì†Œ'] || "";

                    if (lat && lng) {
                        var marker = L.marker([lat, lng])
                                      .bindPopup(`
                                        <div style="text-align:center; min-width:150px;">
                                            <h4 style="margin:0 0 5px 0;">${name}</h4>
                                            <span style="font-size:12px; color:gray;">${address}</span>
                                        </div>
                                      `);
                        markers.addLayer(marker);
                        count++;
                    }
                });

                // ì§€ë„ì— ì¶”ê°€
                map.addLayer(markers);
                
                // ë°ì´í„°ê°€ ìˆìœ¼ë©´ ê·¸ ë²”ìœ„ë¡œ ì¤Œ ì´ë™
                if (count > 0) {
                    map.fitBounds(...)
                    document.getElementById('status-msg').innerText = `ì´ ${count}ê°œì˜ ì‰¼í„° ìš´ì˜ ì¤‘`;
                } else {
                    document.getElementById('status-msg').innerText = `ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
                }
            },
            error: function(err) {
                console.error(err);
                alert("âš ï¸ ì£¼ì˜: ì´ íŒŒì¼ì€ ì›¹ ì„œë²„(Live Server ë“±)ì—ì„œ ì‹¤í–‰í•´ì•¼ ì‘ë™í•©ë‹ˆë‹¤.\nê·¸ëƒ¥ ë”ë¸”í´ë¦­í•´ì„œ ì—´ë©´ ë³´ì•ˆ ë¬¸ì œë¡œ ë°ì´í„°ë¥¼ ëª» ì½ì–´ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            }
        });
    </script>
</body>

</html>
