<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì§€êµ¬ë³¸ - ë¬´ë”ìœ„ ì‰¼í„° ëª¨ë‹ˆí„°ë§</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

    <style>
        /* í™”ë©´ ë†’ì´ ì„¤ì • ë³´ê°• (í° í™”ë©´ ë°©ì§€) */
        html, body { height: 100%; margin: 0; padding: 0; }
        #map { width: 100%; height: 100%; }
        
        .info-box {
            position: absolute; top: 10px; left: 60px; z-index: 1000;
            background: white; padding: 15px 20px; border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            text-align: center; min-width: 200px;
        }
        h2 { margin: 0; font-size: 18px; color: #2c3e50; font-weight: bold; }
        .date-text { margin: 4px 0 8px 0; font-size: 12px; color: #888; }
        .status-text { margin: 0; font-size: 13px; color: #333; font-weight: 500; }
    </style>
</head>
<body>

    <div class="info-box">
        <h2>ğŸŒ ì„œìš¸ì‹œ ë¬´ë”ìœ„ ì‰¼í„°</h2>
        <p class="date-text">(2025-12-04 ê¸°ì¤€)</p>
        <p id="status-msg" class="status-text">ë°ì´í„° ë¡œë”© ì¤‘...</p>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <script>
        // 1. ì§€ë„ ìƒì„± (ì„œìš¸ í™•ëŒ€: ì¤Œ 13)
        var map = L.map('map').setView([37.5665, 126.9780], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        var markers = L.markerClusterGroup();

        // 2. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ì ˆëŒ€ ì£¼ì†Œ ì‚¬ìš©)
        // â˜… ì•„ë˜ ë”°ì˜´í‘œ ì•ˆì— ì•„ê¹Œ ë³µì‚¬í•œ ì£¼ì†Œë¥¼ ë„£ì–´ì£¼ì„¸ìš”!
        var csvUrl = "https://raw.githubusercontent.com/Zigubon/shelter-map/refs/heads/main/shelter_data.csv"; 
        
        // (ë§Œì•½ ì£¼ì†Œ ë³µì‚¬ê°€ ì–´ë ¤ìš°ì‹œë©´ ìœ„ ì£¼ì†Œë¥¼ ê·¸ëŒ€ë¡œ ì¨ë³´ì„¸ìš”. 
        //  IDê°€ 'zigubon', ì €ì¥ì†Œ ì´ë¦„ì´ 'shelter-map', íŒŒì¼ëª…ì´ 'shelter_data.csv'ê°€ ë§ë‹¤ë©´ ì‘ë™í•©ë‹ˆë‹¤.)

        Papa.parse(csvUrl, {
            download: true,
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            encoding: "UTF-8",
            complete: function(results) {
                var data = results.data;
                var count = 0;
                
                // ë°ì´í„°ê°€ ë¹„ì—ˆëŠ”ì§€ í™•ì¸
                if (!data || data.length === 0) {
                    alert("ë°ì´í„° íŒŒì¼ì€ ì½ì—ˆì§€ë§Œ ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
                    return;
                }

                data.forEach(function(row) {
                    var lat = row['ìœ„ë„'] || row['WGS84ìœ„ë„'];
                    var lng = row['ê²½ë„'] || row['WGS84ê²½ë„'];
                    var name = row['ì‰¼í„°ëª…ì¹­'] || row['ì‰¼í„°ëª…'] || "ì´ë¦„ì—†ìŒ";
                    var address = row['ë„ë¡œëª…ì£¼ì†Œ'] || "";

                    if (lat && lng) {
                        var marker = L.marker([lat, lng])
                                      .bindPopup(`<b>${name}</b><br>${address}`);
                        markers.addLayer(marker);
                        count++;
                    }
                });

                map.addLayer(markers);
                
                if (count > 0) {
                    document.getElementById('status-msg').innerText = `ì´ ${count}ê³³ ìš´ì˜ ì¤‘`;
                } else {
                    document.getElementById('status-msg').innerText = "ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
                    alert("ë°ì´í„°ë¥¼ ì½ì—ˆì§€ë§Œ 'ìœ„ë„/ê²½ë„' ì»¬ëŸ¼ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. CSV íŒŒì¼ì˜ ì œëª©ì¤„ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                }
            },
            error: function(err) {
                console.error(err);
                alert("ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤! (404 Error)\nCSV íŒŒì¼ ì´ë¦„ì´ë‚˜ ê²½ë¡œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.");
                document.getElementById('status-msg').innerText = "ë°ì´í„° ë¡œë”© ì‹¤íŒ¨";
            }
        });
    </script>
</body>
</html>
