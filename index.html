<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì§€êµ¬ë³¸ - ë¬´ë”ìœ„ ì‰¼í„° ëª¨ë‹ˆí„°ë§</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

    <style>
        body { font-family: 'Pretendard', sans-serif; margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; }
        
        .info-box {
            position: absolute; top: 10px; left: 60px; z-index: 1000;
            background: white; padding: 15px 20px; border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            text-align: center; min-width: 200px;
        }
        h2 { margin: 0; font-size: 18px; color: #2c3e50; font-weight: bold; }
        
        /* ë‚ ì§œ ìŠ¤íƒ€ì¼ (íšŒìƒ‰, ì‘ì€ ê¸€ì”¨) */
        .date-text { margin: 4px 0 8px 0; font-size: 12px; color: #888; }
        
        /* ìƒíƒœ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .status-text { margin: 0; font-size: 13px; color: #333; font-weight: 500; }
    </style>
</head>
<body>

    <div class="info-box">
        <h2>ğŸŒ ì„œìš¸ì‹œ ë¬´ë”ìœ„ ì‰¼í„°</h2>
        <p class="date-text">(2025-12-04 ê¸°ì¤€)</p>
        <p id="status-msg" class="status-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <script>
        // ì¤Œ ë ˆë²¨ 13 ìœ ì§€ (ì„œìš¸ í™•ëŒ€)
        var map = L.map('map').setView([37.5665, 126.9780], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        var markers = L.markerClusterGroup();

        Papa.parse("./shelter_data.csv", {
            download: true,
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            encoding: "UTF-8",
            complete: function(results) {
                var data = results.data;
                var count = 0;
                
                data.forEach(function(row) {
                    var lat = row['ìœ„ë„'] || row['WGS84ìœ„ë„'];
                    var lng = row['ê²½ë„'] || row['WGS84ê²½ë„'];
                    var name = row['ì‰¼í„°ëª…ì¹­'] || row['ì‰¼í„°ëª…'] || "ì´ë¦„ì—†ìŒ";
                    var address = row['ë„ë¡œëª…ì£¼ì†Œ'] || "";

                    if (lat && lng) {
                        var marker = L.marker([lat, lng])
                                      .bindPopup(`
                                        <div style="text-align:center; min-width:150px;">
                                            <h4 style="margin:0 0 5px 0;">${name}</h4>
                                            <span style="font-size:12px; color:gray;">${address}</span>
                                        </div>
                                      `);
                        markers.addLayer(marker);
                        count++;
                    }
                });

                map.addLayer(markers);
                
                // ê°œìˆ˜ ì—…ë°ì´íŠ¸
                if (count > 0) {
                    document.getElementById('status-msg').innerText = `ì´ ${count}ê³³ ìš´ì˜ ì¤‘`;
                } else {
                    document.getElementById('status-msg').innerText = `ë°ì´í„° ì—†ìŒ`;
                }
            },
            error: function(err) {
                console.error(err);
                alert("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨");
            }
        });
    </script>
</body>
</html>
